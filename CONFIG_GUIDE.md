# Config.py 설정 가이드

config.py의 각 설정 옵션에 대한 상세 설명입니다.

---

## VTube Studio (VTS) 설정

### VTS_ENABLED
- **기능**: VTube Studio 연동(립싱크/핫키)을 켜고 끄는 마스터 스위치
- **값**: True/False
- **설명**: True면 시작 시 VTS 클라이언트를 생성하고, TTS 재생 시 립싱크 파라미터 주입을 시도합니다.

### VTS_WS_URL
- **기능**: VTube Studio Public API WebSocket 주소
- **기본**: `ws://localhost:8001`
- **설명**: VTube Studio에서 `Settings > API > Enable API`가 켜져 있어야 합니다.

### VTS_BACKEND
- **기능**: VTS 클라이언트 구현 선택
- **값**: `"pyvts"` 또는 `"ws"`
- **설명**: 기본은 `"pyvts"`이며, 토큰 파일 기반 인증 및 요청 생성기가 포함됩니다.

### VTS_AUTH_TOKEN_PATH
- **기능**: VTS 인증 토큰을 저장/로드할 파일 경로
- **기본**: `./vts_token.txt`
- **설명**: 최초 1회 토큰 발급 시 파일에 자동 저장되며, 이후 실행부터 자동으로 이 파일을 읽어 인증합니다.

### VTS_EMOTION_HOTKEY_MAP
- **기능**: 감정 → 표정(핫키) 매핑 스캐폴딩
- **형식**: `{ "happy": "HotkeyNameOrID", ... }`
- **설명**: 지금은 틀만 제공되며, 실제 핫키 이름/ID는 추후 채워 넣으면 됩니다.

## LLM 설정

---

## GameHub (게임 모드) 설정

게임(예: KTANE)을 메인 코어에서 분리하기 위해, GameHub를 **별도 HTTP 서비스**로 실행합니다.
메인 코어는 GameHub에서 `system_addendum`/`context_blocks`를 받아서 LLM 호출에 주입합니다.

### GAME_HUB_ENABLED
- **기능**: GameHub 연동 ON/OFF
- **값**: True/False
- **설명**: False면 게임 라우팅/게임 패치 주입을 하지 않습니다.

### GAME_HUB_BASE_URL
- **기능**: GameHub HTTP 주소
- **기본**: `http://127.0.0.1:8765`
- **설명**: GameHub를 다른 PC/포트에서 돌릴 경우 여기를 변경합니다.

### GAME_HUB_HTTP_TIMEOUT_TOTAL_SECONDS / GAME_HUB_HTTP_TIMEOUT_CONNECT_SECONDS
- **기능**: GameHub 호출 타임아웃(전체/연결)
- **설명**: GameHub가 다운되었을 때 메인 코어가 멈추지 않도록 짧게 설정하는 것을 권장합니다.

### GAME_HUB_RAG_MAX_CONTEXT_CHARS
- **기능**: GameHub에서 받은 컨텍스트 블록을 시스템 프롬프트에 주입할 때의 최대 문자 수
- **설명**: 너무 크게 잡으면 llama.cpp 컨텍스트 초과가 발생할 수 있습니다.

### LLM_MAX_HISTORY_MESSAGES_ON_OVERFLOW
- **기능**: llama.cpp가 컨텍스트 초과를 반환할 때 재시도 시 남길 대화 히스토리 메시지 수
- **설명**: 작게 잡을수록 안정적이지만 맥락이 줄어듭니다.

### 게임 시작/종료 발화(권장)
- `"LLM 어떤 게임할래?"`, `"LLM 게임하자"`: LLM이 선택해서 시작
- `"LLM <게임명> 시작해/종료해"`: 강제 시작/종료

> 참고: 기존 `KTANE_*` 설정은 **레거시(구형) 경로**로 남아 있을 수 있으며, 현재 게임 모드는 GameHub 플러그인(`game_hub/games/...`) 기준으로 확장하는 것을 권장합니다.

### LLM_RESPONSE_TEMPERATURE
- 기능: LLM 출력의 랜덤성을 조절합니다. 다음 토큰 선택 시 확률 분포를 조정합니다.
- 범위: 0.0 ~ 2.0 (기본값: 0.8)
- 낮은 값: 결정적이고 일관된 응답. 같은 입력에 비슷한 출력.
- 높은 값: 창의적이고 다양한 응답. 예측 불가능한 출력.
- 튜닝: 0.2~0.4는 사실 기반 답변, 0.7~0.9는 자연스러운 대화에 적합.

### LLM_RESPONSE_TOP_P
- 기능: 누적 확률 기반 샘플링(nucleus sampling). 확률 합이 top_p가 될 때까지의 토큰만 후보로 사용.
- 범위: 0.0 ~ 1.0 (기본값: 0.92)
- 낮은 값: 소수의 확률 높은 토큰만 선택. 일관성 높고 반복 증가.
- 높은 값: 다양한 토큰 후보 고려. 창의성 증가, 가끔 이상한 단어 선택.
- 튜닝: temperature와 함께 조정. 둘 다 높으면 너무 랜덤함.

### LLM_RESPONSE_TOP_K
- 기능: 상위 K개 토큰만 샘플링 후보로 사용. top_p와 다르게 고정된 개수 제한.
- 범위: 1 ~ ∞ (기본값: 40)
- 낮은 값: 제한적인 선택. 일관성 높고 창의성 낮음.
- 높은 값: 다양한 후보. 창의성 높지만 관련 없는 단어 가능.
- 튜닝: 20~50이 일반적. top_k=1은 항상 최고 확률 토큰 선택(greedy).

### LLM_RESPONSE_REPEAT_PENALTY
- 기능: 이미 생성된 토큰의 확률에 페널티를 부여하여 반복을 억제.
- 범위: 1.0 ~ 2.0 (기본값: 1.05)
- 1.0: 페널티 없음. "네네네네" 같은 반복 가능.
- 1.0~1.1: 가벼운 억제. 자연스러운 대화에 적합.
- 1.2 이상: 강한 억제. 어색한 동의어 사용 가능.
- 튜닝: 1.02~1.1이 대부분의 경우 적합.

---

## LLM Judge 설정

### LLM_JUDGE_TEMPERATURE
- 기능: 판단 LLM의 temperature. 낮을수록 일관된 Y/W/N 판단.
- 범위: 0.0 ~ 1.0 (기본값: 0.2)
- 튜닝: 판단은 일관성이 중요하므로 0.1~0.3 권장.

### JUDGE_MAX_RETRIES
- 기능: Judge가 Y/W/N 외 응답 시 재시도 횟수.
- 범위: 0 ~ ∞ (기본값: 2)
- 튜닝: 2~3이면 충분. 너무 높으면 응답 지연.

---

## 대화 흐름 제어

### MAX_CONVERSATION_HISTORY
- 기능: LLM에 전달할 대화 기록 메시지 수.
- 범위: 1 ~ ∞ (기본값: 10)
- 낮은 값: 토큰 절약, 빠른 응답, 맥락 이해 부족.
- 높은 값: 풍부한 맥락, 느린 응답, 토큰 많이 사용.
- 튜닝: 10~20이 적당. 길이보다 품질이 중요.

### WAIT_RESPONSE_TIMEOUT
- 기능: Judge가 'W'(대기) 판단 시 응답 전 기다리는 시간(초).
- 범위: 0.0 ~ ∞ (기본값: 5.0)
- 낮은 값: 빠른 개입. 사람들 답변 시간 부족.
- 높은 값: 충분한 대기. 대화 흐름이 느려짐.
- 튜닝: 3~7초가 자연스러움.

---

## STT 설정

### STT_BEAM_SIZE
- 기능: 전사 과정에서 동시에 탐색하는 경로(후보) 수. 빔 서치 알고리즘의 너비.
- 범위: 1 ~ ∞ (기본값: 5)
- 낮은 값: 빠른 처리, 낮은 정확도. 1은 greedy 탐색.
- 높은 값: 높은 정확도, 느린 처리, VRAM 많이 사용.
- 튜닝: 1~3은 실시간용, 5~10은 정확도 중시.

### STT_BEST_OF
- 기능: N개 후보를 생성하고 그 중 최선을 선택.
- 범위: 1 ~ ∞ (기본값: 5)
- 낮은 값: 빠름. 첫 결과 사용.
- 높은 값: 품질 향상. 처리 시간 증가.
- 튜닝: beam_size와 유사하게 조정.

### STT_PATIENCE
- 기능: 빔 서치 조기 종료 factor. 1.0이면 표준 종료.
- 범위: 0.0 ~ ∞ (기본값: 1.0)
- 낮은 값: 더 빨리 종료. 정확도 소폭 하락.
- 높은 값: 더 오래 탐색. 약간 더 좋은 결과.

### STT_BATCH_SIZE
- 기능: 배치 처리 크기. 여러 오디오 청크를 한 번에 처리.
- 범위: 0 ~ ∞ (기본값: 16)
- 0: 배치 처리 비활성화.
- 높은 값: 처리량 증가, 메모리 사용 증가.

### STT_SUPPRESS_TOKENS
- 기능: 출력에서 억제할 토큰 ID 리스트.
- 기본값: [-1] (특수 토큰 억제)
- 특정 단어/토큰을 출력에서 제외하고 싶을 때 사용.

### STT_NORMALIZE_AUDIO
- 기능: 오디오를 -0.95 dBFS로 정규화. 볼륨 차이 보정.
- 범위: True/False (기본값: False, 권장: True)
- True: 작거나 큰 소리를 일정하게 조정. 정확도 향상.
- False: 원본 오디오 그대로 사용.

### STT_TEMPERATURE
- 기능: 디코딩 temperature. 리스트로 주면 실패 시 순차 재시도.
- 범위: 0.0 ~ 1.0 또는 리스트 (기본값: [0.0, 0.2, 0.4, 0.6, 0.8, 1.0])
- 0.0: 결정적. 가장 확실한 결과.
- 리스트: 어려운 오디오에서 점진적 재시도. 노이즈 많은 환경에 유용.
- 튜닝: 단일 0.0은 빠르고, 리스트는 어려운 오디오에 강함.

### STT_COMPRESSION_RATIO_THRESHOLD
- 기능: 텍스트 gzip 압축률 임계값. 반복 텍스트(환각) 감지.
- 범위: 0.0 ~ ∞ (기본값: 2.4)
- 낮은 값: 엄격한 필터링. 정상 텍스트도 걸러질 수 있음.
- 높은 값: 느슨한 필터링. 환각 통과 가능.
- 튜닝: 2.0~2.4가 적당. 환각 많으면 낮추기.

### STT_LOG_PROB_THRESHOLD
- 기능: 평균 로그 확률 임계값. 이하면 저품질로 판단.
- 범위: -∞ ~ 0.0 (기본값: -1.0)
- 높은 값(-0.5): 높은 신뢰도만 허용. 많은 음성 무시됨.
- 낮은 값(-2.0): 낮은 신뢰도 허용. 노이즈도 텍스트화.
- 튜닝: -1.0이 균형적. 누락 많으면 -1.5로 낮추기.

### STT_NO_SPEECH_THRESHOLD
- 기능: 무음/비음성 확률 임계값. 이 이상이면 음성 없음으로 판단.
- 범위: 0.0 ~ 1.0 (기본값: 0.6)
- 낮은 값: 민감하게 무음 감지. 환각 감소. 작은 소리 놓칠 수 있음.
- 높은 값: 덜 민감. 노이즈를 음성으로 오인. 환각 증가.

### STT_VAD_THRESHOLD
- 기능: VAD(Voice Activity Detection)의 음성 확률 임계값.
- 범위: 0.0 ~ 1.0 (기본값: 0.5)
- 낮은 값: 작은 소리도 음성으로 인식. 노이즈 민감.
- 높은 값: 확실한 음성만 인식. 일부 음성 누락.
- 튜닝: 0.4~0.6. 노이즈 많으면 높이기.

### STT_VAD_MIN_SPEECH_MS
- 기능: 최소 음성 길이(ms). 이보다 짧으면 무시.
- 범위: 0 ~ ∞ (기본값: 250)
- 낮은 값: 짧은 발화("네", "아") 인식. 클릭음도 인식될 수 있음.
- 높은 값: 긴 발화만 인식. 짧은 대답 놓침.
- 튜닝: 150~300 적당.

### STT_VAD_MIN_SILENCE_MS
- 기능: 음성 세그먼트 구분용 무음 길이(ms). 이 이상 무음이면 새 세그먼트로 분리.
- 범위: 0 ~ ∞ (기본값: 2000)
- 낮은 값: 짧은 쉼도 구분점. 문장 중간에 끊김. 빠른 반응.
- 높은 값: 긴 쉼 후에만 구분. 완전한 문장 단위. 응답 지연.

### STT_VAD_SPEECH_PAD_MS
- 기능: 음성 세그먼트 앞뒤 패딩(ms). 음성 시작/끝 보호.
- 범위: 0 ~ ∞ (기본값: 400)
- 낮은 값: 음성 시작/끝 잘림. 단어 누락 가능.
- 높은 값: 안전한 마진. 노이즈도 포함됨.
- 튜닝: 300~500 적당.

### MIN_SILENCE_DURATION_MS
- 기능: 사용자가 말을 멈췄다고 판단하는 무음 시간(ms). STT 프로세스용.
- 범위: 0 ~ ∞ (기본값: 200)
- 낮은 값: 매우 빠른 반응. 문장 중간 끊김 가능.
- 높은 값: 안정적인 문장 완료 감지. 응답 지연.

### STT_MIN_RMS_THRESHOLD
- 기능: RMS(Root Mean Square) 에너지 임계값. 무음/노이즈 필터.
- 범위: 0.0 ~ 1.0 (기본값: 0.01)
- 낮은 값: 조용한 음성도 처리. 배경 노이즈도 처리됨.
- 높은 값: 확실한 음성만 처리. 조용한 발화 무시.
- 튜닝: 0.005~0.02. 조용한 환경이면 낮게.

---

## TTS 설정

### TTS_VOLUME
- 기능: 출력 볼륨 배율.
- 범위: 0.0 ~ 2.0 (기본값: 0.25)
- 0.0: 무음
- 1.0: 원본 볼륨
- 2.0: 2배 증폭
- 튜닝: Discord에서는 0.2~0.5가 적당.

### TTS_SENTENCE_DELIMITERS
- 기능: TTS 청킹용 문장 구분자. 이 문자에서 잘라서 순차 재생.
- 기본값: ['.', '!', '?', '\n', '。']
- 튜닝: 언어에 맞게 조정. 한국어는 '.'만으로도 충분할 수 있음.
